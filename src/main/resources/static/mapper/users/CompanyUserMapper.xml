<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
	namespace="com.laonworks502.team1st.dao.users.CompanyUserDao">

	<!-- 기업 등록 -->
	<insert id="joinCompany"
		parameterType="com.laonworks502.team1st.model.company.CompanyBean">
		insert into companies
		(company_name,field,postal_code,address1,address2,tel1,tel2,tel3,foundation_date)
		values(#{company_name},#{field},#{postal_code},#{address1},#{address2},#{tel1},#{tel2},#{tel3},#{foundation_date})
	</insert>
	
	<!-- 기업 회원 가입 -->
	<insert id="CompanyjoinUser"
		parameterType="com.laonworks502.team1st.model.users.CompanyUserBean">
		insert into company_users
		(email,passwd,company_name,name,tel1,tel2,tel3,register_date,exit_reason)
		values(#{email},#{passwd},#{company_name},#{name},#{tel1},#{tel2},#{tel3},now(),#{exit_reason})
	</insert>

	<!-- 기업 회원 정보 수정 -->
	<update id="amendUser"
		parameterType="com.laonworks502.team1st.model.users.CompanyUserBean">
		update company_users
		set name=#{name},tel1=#{tel1},tel2=#{tel2},tel3=#{tel3}
		where email = #{email}
	</update>

	<!-- email 중복 체크 -->
	<select id="emailcheck" parameterType="String" resultType="int">
		SELECT COUNT(*) FROM company_users WHERE email = #{email}
	</select>

	<!-- 이메일로 회원 검색 -->
	<select id="getMember" parameterType="String"
		resultType="com.laonworks502.team1st.model.users.CompanyUserBean">
		select * from company_users where email = #{email} and exit_reason is null 
	</select>

	<!-- 기업명으로 기업 검색 -->
	<select id="getCompany" parameterType="String"
		resultType="com.laonworks502.team1st.model.company.CompanyBean">
		select*from companies where company_name= #{company_name}
	</select>

	<!--[비번 찾기) 메일 보내기] -->
	<select id="pwfind"
		resultType="com.laonworks502.team1st.model.users.CompanyUserBean"
		parameterType="com.laonworks502.team1st.model.users.CompanyUserBean">
		select * from company_users where email = #{email} and exit_reason is null and
		name = #{name}
	</select>

	<!-- 기업 회원 탈퇴 -->
	<update id="quitUser">
		update company_users set exit_reason=#{exit_reason} where email=#{email}
	</update>

</mapper>